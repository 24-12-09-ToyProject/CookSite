<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ details.product.PRODUCT_NAME }}</title>
    <link rel="stylesheet" href="../../static/css/store/storeDetail.css">
</head>

<body>
    <div class="product-detail-container">
        <section class="product-info">
            <div class="product-image">
                <img src="{{ details.product.PPODUCT_MAIN_IMG_URL }}" alt="{{ details.product.PRODUCT_NAME }}">
            </div>
            <div class="product-text">
                <div class="product-header">
                    <span>{{ details.product.PRODUCT_NAME }}</span>
                </div>

                <div class="product-price">
                    <p><strong>{{ details.product.BASE_PRICE }} 원</strong></p>
                </div>
                <div class="shipping-info">
                    <img src="../../static/img/store/van.png" alt="" class="shipping-icon">
                    <p>배송 <strong>3,500원</strong> (70,000원 이상 무료배송)</p>
                </div>
                <div class="reward-info">
                    <img src="../../static/img/store/coin.png" alt="" class="reward-icon">
                    <p>적립 <strong><span id="reward-amount"></span></strong> 원 적립 (구매액의 0.5% 적립)</p>
                </div>
                <section class="product-options">
                    {% if details.options and details.options|length > 0 %}
                    <form action="/cart/add" method="POST">
                        <div class="option-select">
                            <label for="product-option"></label>
                            <select name="option" id="product-option" required>
                                <option value="" disabled selected>[선택] 옵션을 선택하세요.</option>
                                {% for option in details.options %}
                                <option value="{{ option.OPTION_NO }}" data-name="{{ option.OPTION_NAME }}"
                                    data-price="{{ option.OPTION_PRICE_DIFF }}" data-stock="{{ option.OPTION_STOCK }}">
                                    {{ option.OPTION_NAME }} (재고수량 : {{ option.OPTION_STOCK }} 개)
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="selected-option-details">
                            <p><strong><span id="selected-option-name"></span></strong></p>
                            <p><strong><span id="selected-option-price"></span></strong></p>
                            <div>
                                <button type="button" id="decrease-btn">-</button>
                                <span id="quantity">1</span>
                                <button type="button" id="increase-btn">+</button>
                            </div>
                            <p>주문금액 <span id="total-price"></span></p>
                        </div>
                        <button type="submit" class="add-to-cart">장바구니</button>
                        <button class="buy-now">바로구매</button>
                    </form>
                    {% else %}
                    <p>옵션이 없습니다.</p>
                    {% endif %}
                </section>
        </section>
    </div>

    </div>
    <div class="product-sub-image">
        <img src="{{ details.product.PPODUCT_SUB_IMG_URL }}" alt="{{ details.product.PRODUCT_NAME }}">
    </div>

    <script>
        // 상품 기본 가격을 변수로 설정
        const basePrice = {{ details.product.BASE_PRICE }};
        
        // window.productData = {
        //     basePrice : "{{ details.product.BASE_PRICE }}"
        // }
        // console.log(basePrice);

        // const basePrice = window.productData.basePrice;

        

        // 기본 적립금 계산 (구매액의 0.5%)
        const rewardAmount = basePrice * 0.005;

        // 적립 금액 업데이트
        document.getElementById('reward-amount').textContent = rewardAmount.toFixed(0); // 소수점 없이 출력

        // 초기 수량 설정
        let quantity = 1;
        let optionPriceDiff = 0; // 옵션 가격 차이

        // 수량 표시 요소
        const quantityElement = document.getElementById('quantity');

        // 총 가격 표시 요소
        const totalPriceElement = document.getElementById('total-price');

        // 수량 증가 버튼
        const increaseBtn = document.getElementById('increase-btn');

        // 수량 감소 버튼
        const decreaseBtn = document.getElementById('decrease-btn');

        // 수량 증가 기능
        increaseBtn.addEventListener('click', function () {
            quantity++;
            quantityElement.textContent = quantity;
            updateTotalPrice();
        });

        // 수량 감소 기능
        decreaseBtn.addEventListener('click', function () {
            if (quantity > 1) { // 최소 수량을 1로 제한
                quantity--;
                quantityElement.textContent = quantity;
                updateTotalPrice();
            }
        });

        // 옵션 선택 시 가격과 옵션명을 업데이트하는 기능
        document.getElementById('product-option').addEventListener('change', function () {
            const selectedOption = this.options[this.selectedIndex];
            const optionName = selectedOption.getAttribute('data-name');
            optionPriceDiff = parseInt(selectedOption.getAttribute('data-price'), 10);  // 옵션 가격 차이
            const totalPrice = basePrice + optionPriceDiff;  // 기본 가격과 옵션 가격 차이 합산

            // 선택된 옵션명과 가격 업데이트
            document.getElementById('selected-option-name').textContent = optionName;
            document.getElementById('selected-option-price').textContent = totalPrice + "원";

            // 옵션 선택 시 옵션 정보 표시
            document.querySelector('.selected-option-details').style.display = 'block';

            updateTotalPrice(); // 옵션 선택 후 총 가격 업데이트
        });

        // 총 가격 업데이트 함수
        function updateTotalPrice() {
            const totalPrice = (basePrice + optionPriceDiff) * quantity;
            totalPriceElement.textContent = totalPrice.toLocaleString() + " 원"; // 가격에 천 단위 쉼표 추가
        }

        // 초기 총 가격 설정 (옵션 선택 전)
        updateTotalPrice();
    </script>
</body>

</html>