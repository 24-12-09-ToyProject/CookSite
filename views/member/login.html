{% extends "common/layout.html" %}

{% block extra_styles %}
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script>
	<link rel="stylesheet" href="/static/css/member/login.css">
{% endblock %}


{% block content %}
<h1>login 페이지</h1>

		<!-- login 실행 form -->
		<form id="signin-form" action="/member/login" method="post">
			<div>
				아이디
				<input id="memberId" type="text" name="memberId" placeholder="아이디" required autocomplete="off">
			</div>
			<div>
				비밀번호
				<input id="memberPw" type="password" name="memberPw" placeholder="패스워드" required autocomplete="off">
			</div>
			<button type="button" onclick="signin();">로그인</button>
		</form>

		<a href="">아이디 찾기</a>
		<a href="">비밀번호 찾기</a>
		<a href="/member/signUp">
			<div>회원가입</div>
		</a>

		<hr>
		<hr>

		<div>더욱 간편한 로그인/회원가입</div>
		<div>
			<img id="naver-logo" src="/static/img/member/naverLogo.png" alt="" onclick="openNaverLogin();">
		</div>
		<input type="hidden" id="parentEl">
		<div>카카오, 네이버..</div>


		<hr>
		<hr>

		회사소개, 이용약관, 이용안내, 개인정보처리방침
{% endblock %}

{% block extra_scripts %}
<script>

	let deleteResult = "{{deleteResult}}";
	let signupResult = "{{signupResult}}";
	let loggedInMessage = "{{loggedInMessage}}";

	if(signupResult === 'success'){
		Swal.fire({
					icon: 'success',
					title: 'Alert가 실행되었습니다.',
					text: '회원가입 성공',
		});
	}else if(signupResult === 'fail'){
		Swal.fire({
					icon: 'warning',
					title: 'Alert가 실행되었습니다.',
					text: '회원가입 오류 발생',
		});
	}else if(loggedInMessage === '로그아웃상태'){
		Swal.fire({
					icon: 'warning',
					title: 'Alert가 실행되었습니다.',
					text: '로그인 후 이용해주세요',
		});
	}else if(deleteResult === 'success'){
		Swal.fire({
					icon: 'success',
					title: 'Alert가 실행되었습니다.',
					text: '탈퇴되었습니다',
		});
	}

	
	// id입력해주세요 -> 패스워드 입력해주세요 (클라이언트에서 검증)-> 아이디/비밀번호가 일치하지 않습니다 (서버에서 검증)
	const elMemberId = document.querySelector('#memberId');
	const elMemberPw = document.querySelector('#memberPw');

	const signinForm = document.querySelector('#signin-form');
	
	function checkValidInput(){

		// id 필수입력 체크
		if(elMemberId.value === ""){
			alert("아이디를 입력해주세요");
			return;
		}
		
		// pw 필수입력 체크
		if(elMemberPw.value === ""){
			alert("비밀번호를 입력해주세요");
			return;
		}

		// 서버 검증
		signinForm.submit();


	}

	function signin(){
		checkValidInput();
	}



	function openNaverLogin(){
		const api_url = "{{api_url}}";

		const popup = window.open(
        api_url,  // 팝업에서 실행할 로그인 페이지
        '네이버 로그인',
        'width=500,height=600,top=100,left=100'
    );
	}


	

	// 팝업창 통해서 로그인 성공 후 값 변경 감지하여 페이지 이동
	const parentEl = document.getElementById("parentEl");

	// MutationObserver 설정
	const observer = new MutationObserver(() => {
			console.log("Value changed:", parentEl.value);
			if (parentEl.value) {
					window.location.href = `/member/detail`; // 임시 (index파일 없음)
			}
	});

	// 감시할 대상과 설정 (value 변경 감지)
	observer.observe(parentEl, { attributes: true, attributeFilter: ["value"] });



</script>
{% endblock %}

